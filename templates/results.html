<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Results • Find Your Next…</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <h1>Find Your Next…</h1>
    <p id="heroLine">
      {% if q or genre %}
        You entered a {{ input_kind|capitalize }}: “{{ q if q else genre }}”. We’re recommending {{ target_kind|capitalize }}s.
      {% else %}
        Results based off your search
      {% endif %}
    </p>
  </header>

  <main class="wrap">
    <section class="card">
      <div class="summary">
        <div class="summary-main">
          <h2>Recommendations</h2>
          <div id="summaryText" class="meta">
            {% if recommendations %}
              Showing top {{ limit }} {{ target_kind|capitalize }} recommendations.
            {% else %}
              No results found.
            {% endif %}
          </div>

          <div id="pills" class="pills-row">
            {% if q %}
              <span class="pill">Query: {{ q }}</span>
            {% endif %}
            {% if genre %}
              <span class="pill">Genre: {{ genre }}</span>
            {% endif %}
            <span class="pill">{{ input_kind|capitalize }} → {{ target_kind|capitalize }}</span>
          </div>
        </div>

        <div class="summary-toolbar">
          <a class="back-link" href="/">← Back to search</a>

          <div class="controls">
            <div class="control-group">
              <span class="control-label">Show</span>
              <form action="/recommend" method="get" style="display:inline;">
                <input type="hidden" name="inputKind" value="{{ input_kind }}">
                <input type="hidden" name="targetKind" value="{{ target_kind }}">
                <input type="hidden" name="q" value="{{ q }}">
                <input type="hidden" name="genre" value="{{ genre }}">
                
                <select id="limit" name="limit" onchange="this.form.submit()" aria-label="Number of results to show">
                  <option value="3" {% if limit == 3 %}selected{% endif %}>3</option>
                  <option value="4" {% if limit == 4 %}selected{% endif %}>4</option>
                  <option value="9" {% if limit == 9 %}selected{% endif %}>9</option>
                  <option value="12" {% if limit == 12 %}selected{% endif %}>12</option>
                </select>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div id="results" class="grid">
        {% if error %}
          <div class="error-box" style="grid-column: 1 / -1; padding: 20px; background: #fee2e2; border: 1px solid #ef4444; color: #b91c1c; border-radius: 12px; text-align: center;">
            <h3>⚠️ Connection Error</h3>
            <p>{{ error }}</p>
          </div>
      
        {% elif recommendations %}
          {% for item in recommendations %}
            <a class="item" href="{{ url_for('detail', id=item.id, kind=item.kind) }}">
              <img class="thumb" src="{{ item.image }}" alt="{{ item.title }}" onerror="this.src='/static/images/image-not-available.jpg'">
              <div class="pad">
                <div class="title">{{ item.title }}</div>
                <div class="meta-small">{{ item.kind }} • {{ item.year }}</div>
              </div>
            </a>
          {% endfor %}

        {% else %}
          <div class="empty" style="grid-column: 1 / -1; display:block; padding: 40px; text-align: center; color: #666;">
            No results found. Try a different search or genre. If you continue to see this error, daily API limits have been reached.
          </div>
        {% endif %}
      </div>
      
    </section>
  </main>

  <footer>© 2025 Find Your Next…</footer>
</body>
</html>